CREATE OR REPLACE PROCEDURE "AD_PRIO_DEC"(AID IN NUMBER)  IS
BEGIN
UPDATE ADVERTISEMENT
SET PRIORITY=PRIORITY-1
WHERE (ADVERTISEMENTID= AID AND PRIORITY>0);
END ;


CREATE OR REPLACE PROCEDURE "AD_PRIO_INC"(AID IN NUMBER)  IS
BEGIN
UPDATE ADVERTISEMENT
SET PRIORITY=PRIORITY+1
WHERE (ADVERTISEMENTID= AID);
END ;

CREATE OR REPLACE PROCEDURE "ADD_BRAND" (BRANDNAME IN VARCHAR2,LOGO IN VARCHAR2,COUNTRY IN VARCHAR2) IS 

BEGIN
INSERT INTO BRANDS(BRANDNAME,LOGO,COUNTRY)
VALUES (BRANDNAME,LOGO,COUNTRY);
END ;


CREATE OR REPLACE PROCEDURE "ADD_NEWS" (DETAILS IN VARCHAR2) IS 

BEGIN
INSERT INTO BREAKING_NEWS(DETAILS)
VALUES (DETAILS);
END ;

CREATE OR REPLACE PROCEDURE "ADD_TO_CART" (UID IN NUMBER, PID IN NUMBER)  IS
PCOUNT NUMBER;
BEGIN
PCOUNT:=ALREADY_IN_CART(UID,PID);
IF PCOUNT>0 THEN
UPDATE CART
SET QUANTITY=QUANTITY+1
WHERE (USERID =UID AND PRODUCTID =PID);
ELSE
INSERT INTO CART
VALUES (UID,PID,1);
END IF;
END ;


CREATE OR REPLACE FUNCTION "ALREADY_IN_CART"(UID IN NUMBER, PID IN NUMBER) 
RETURN NUMBER IS
PCOUNT NUMBER;

BEGIN
PCOUNT := 0;

SELECT QUANTITY INTO PCOUNT
FROM CART 
WHERE USERID =UID AND PRODUCTID =PID ;
RETURN PCOUNT ;

EXCEPTION
WHEN NO_DATA_FOUND THEN
RETURN 0 ;
END ;


CREATE OR REPLACE PROCEDURE "BAN_UNBAN_USER" (UID IN NUMBER)
AS
BEGIN
 UPDATE USERS
    SET IS_BAN = 1-IS_BAN
    WHERE USERID = UID;
END;



CREATE OR REPLACE PROCEDURE "DECREASE_CART"(UID IN VARCHAR2, PID IN VARCHAR2)  IS
PCOUNT NUMBER;
BEGIN
    UPDATE CART
    SET QUANTITY = QUANTITY-1
    WHERE USERID = UID AND PRODUCTID= PID;
		SELECT QUANTITY INTO PCOUNT 
		FROM CART
		WHERE USERID = UID AND PRODUCTID= PID;

IF PCOUNT=0 THEN
DELETE FROM CART
WHERE (USERID= UID AND PRODUCTID= PID);
END IF;
END ;


CREATE OR REPLACE PROCEDURE "DELETE_AD" (AID IN NUMBER)  IS
BEGIN
    DELETE FROM ADVERTISEMENT
    WHERE ADVERTISEMENTID = AID;
END ;


CREATE OR REPLACE PROCEDURE "DELETE_BRAND" (BID IN NUMBER)
AS
BEGIN

    DELETE FROM BRANDS
    WHERE BRANDID = BID;
END;


CREATE OR REPLACE PROCEDURE "DELETE_NEWS"(NID IN NUMBER)  IS
BEGIN
    DELETE FROM BREAKING_NEWS
    WHERE BN_ID = NID;
END ;

CREATE OR REPLACE PROCEDURE "DELETE_USER" (UID IN NUMBER)
AS
BEGIN
    DELETE FROM USERS
    WHERE USERID = UID;
END;